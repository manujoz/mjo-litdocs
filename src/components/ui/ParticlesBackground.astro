---
// Animated particles background component with parallax effect
---

<div class="particles-background" aria-hidden="true">
    <div class="particles-container">
        <!-- Primary particles (circles with gradient) -->
        <div class="particle particle-primary particle-large particle-1" data-speed="0.3"></div>
        <div class="particle particle-primary particle-medium particle-2" data-speed="0.5"></div>
        <div class="particle particle-primary particle-large particle-3" data-speed="0.2"></div>
        <div class="particle particle-primary particle-small particle-4" data-speed="0.7"></div>
        <div class="particle particle-primary particle-medium particle-5" data-speed="0.4"></div>
        <div class="particle particle-primary particle-large particle-6" data-speed="0.6"></div>

        <!-- Secondary particles (circles with gradient) -->
        <div class="particle particle-secondary particle-medium particle-7" data-speed="0.3"></div>
        <div class="particle particle-secondary particle-small particle-8" data-speed="0.8"></div>
        <div class="particle particle-secondary particle-large particle-9" data-speed="0.2"></div>
        <div class="particle particle-secondary particle-medium particle-10" data-speed="0.5"></div>
        <div class="particle particle-secondary particle-small particle-11" data-speed="0.4"></div>

        <!-- Accent particles (squares with gradient) -->
        <div class="particle particle-accent particle-square particle-medium particle-12" data-speed="0.6"></div>
        <div class="particle particle-accent particle-square particle-small particle-13" data-speed="0.3"></div>
        <div class="particle particle-accent particle-square particle-large particle-14" data-speed="0.7"></div>
        <div class="particle particle-accent particle-square particle-medium particle-15" data-speed="0.4"></div>
    </div>

    <!-- Subtle gradient overlay with parallax -->
    <div class="particles-gradient"></div>
</div>

<script>
    // Parallax effect for particles with optimized performance
    function initParallax() {
        const particles = document.querySelectorAll(".particle") as NodeListOf<HTMLElement>;
        const background = document.querySelector(".particles-background") as HTMLElement;

        if (!particles.length || !background) return;

        let ticking = false;

        // Check if user prefers reduced motion
        const prefersReducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
        if (prefersReducedMotion) return;

        function updateParallax() {
            const scrollTop = window.pageYOffset;
            const windowHeight = window.innerHeight;
            const backgroundHeight = background.offsetHeight;

            // Calculate parallax rates
            const bgRate = scrollTop * -0.3; // Slower background movement

            // Update background position using CSS custom property
            background.style.setProperty("--parallax-bg", `${bgRate}px`);

            // Individual particle parallax with varying speeds
            particles.forEach((particle: HTMLElement) => {
                const speed = parseFloat(particle.dataset.speed || "0.5");
                const yPos = scrollTop * speed * -0.2; // Reduced multiplier for subtlety

                // Use CSS custom property for better performance
                particle.style.setProperty("--parallax-y", `${yPos}px`);
            });

            // Fade out effect as we scroll past the background height
            const fadeStart = backgroundHeight * 0.8;
            const fadeEnd = backgroundHeight * 1.2;

            if (scrollTop > fadeStart) {
                const fadeProgress = Math.min(1, (scrollTop - fadeStart) / (fadeEnd - fadeStart));
                const opacity = 1 - fadeProgress;
                background.style.opacity = opacity.toString();
            } else {
                background.style.opacity = "1";
            }

            ticking = false;
        }

        function requestTick() {
            if (!ticking) {
                requestAnimationFrame(updateParallax);
                ticking = true;
            }
        }

        // Throttled scroll listener
        window.addEventListener("scroll", requestTick, { passive: true });

        // Handle resize
        window.addEventListener("resize", requestTick, { passive: true });

        // Initial call
        updateParallax();
    }

    // Initialize when DOM is ready
    if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initParallax);
    } else {
        initParallax();
    }

    // Re-initialize on page navigation (for SPAs)
    document.addEventListener("astro:page-load", initParallax);
</script>

<style>
    .particles-background {
        position: fixed;
        inset: 0;
        top: 0;
        pointer-events: none;
        overflow: hidden;
        height: 90vh;
        z-index: -10;
        will-change: transform;
    }

    .particles-container {
        position: relative;
        width: 100%;
        height: 100%;
    }

    .particles-gradient {
        position: absolute;
        inset: 0;
        background: radial-gradient(ellipse at center, var(--color-accent), transparent 70%);
        opacity: 0.02;
        will-change: transform;
    }

    .particle {
        position: absolute;
        border-radius: 999px;
        transition: all 0.3s;
        will-change: transform;
    }

    .particle-square {
        border-radius: 0;
    }

    /* Particle sizes */
    .particle-small {
        width: 8px;
        height: 8px;
    }

    .particle-medium {
        width: 12px;
        height: 12px;
    }

    .particle-large {
        width: 16px;
        height: 16px;
    }

    /* Primary particles - Blue gradient */
    .particle-primary {
        background: radial-gradient(circle, var(--color-primary-100), var(--color-primary-400));
        opacity: 0.5;
    }

    :global(.dark) .particle-primary {
        background: radial-gradient(circle, var(--color-primary-200), var(--color-primary-500));
        opacity: 0.25;
    }

    /* Secondary particles - Green gradient */
    .particle-secondary {
        background: radial-gradient(circle, var(--color-secondary-100), var(--color-secondary-400));
        opacity: 0.6;
    }

    :global(.dark) .particle-secondary {
        background: radial-gradient(circle, var(--color-secondary-200), var(--color-secondary-500));
        opacity: 0.2;
    }

    /* Accent particles - Gray gradient */
    .particle-accent {
        background: var(--color-destructive);
        opacity: 0.1;
    }

    :global(.dark) .particle-accent {
        background: var(--color-destructive);
        opacity: 0.15;
    }

    /* Respect reduced motion preference */
    @media (prefers-reduced-motion: reduce) {
        .particle {
            animation: none !important;
        }
        .particles-background {
            transform: none !important;
        }
    }

    /* Smooth parallax performance */
    @media (prefers-reduced-motion: no-preference) {
        .particles-background {
            transform: translateY(var(--parallax-bg, 0px));
        }

        .particle {
            transform: translateY(var(--parallax-y, 0px));
        }
    }

    /* Individual particle positions and animations */
    .particle-1 {
        top: 20%;
        left: 10%;
        animation: float-1 25s infinite linear;
    }

    .particle-2 {
        top: 60%;
        left: 75%;
        animation: float-2 30s infinite linear;
    }

    .particle-3 {
        top: 40%;
        left: 85%;
        animation: float-3 35s infinite linear;
    }

    .particle-4 {
        top: 80%;
        left: 65%;
        animation: float-4 28s infinite linear;
    }

    .particle-5 {
        top: 15%;
        left: 50%;
        animation: float-5 32s infinite linear;
    }

    .particle-6 {
        top: 75%;
        left: 20%;
        animation: float-6 26s infinite linear;
    }

    .particle-7 {
        top: 35%;
        left: 30%;
        animation: float-7 31s infinite linear;
    }

    .particle-8 {
        top: 85%;
        left: 45%;
        animation: float-8 27s infinite linear;
    }

    .particle-9 {
        top: 25%;
        left: 70%;
        animation: float-9 36s infinite linear;
    }

    .particle-10 {
        top: 65%;
        left: 15%;
        animation: float-10 24s infinite linear;
    }

    .particle-11 {
        top: 55%;
        left: 90%;
        animation: float-11 34s infinite linear;
    }

    .particle-12 {
        top: 45%;
        left: 60%;
        animation: float-rotate-1 45s infinite linear;
    }

    .particle-13 {
        top: 70%;
        left: 80%;
        animation: float-rotate-2 42s infinite linear;
    }

    .particle-14 {
        top: 30%;
        left: 5%;
        animation: float-rotate-3 48s infinite linear;
    }

    .particle-15 {
        top: 90%;
        left: 25%;
        animation: float-rotate-4 41s infinite linear;
    }

    /* Responsive: Hide some particles on mobile */
    @media (max-width: 768px) {
        .particle-8,
        .particle-9,
        .particle-10,
        .particle-11,
        .particle-15 {
            display: none;
        }
    }

    /* Float animations for circular particles */
    @keyframes float-1 {
        0%,
        100% {
            transform: translateY(0px) translateX(0px);
        }
        25% {
            transform: translateY(-30px) translateX(15px);
        }
        50% {
            transform: translateY(-60px) translateX(-10px);
        }
        75% {
            transform: translateY(-90px) translateX(20px);
        }
    }

    @keyframes float-2 {
        0%,
        100% {
            transform: translateY(0px) translateX(0px);
        }
        33% {
            transform: translateY(40px) translateX(-15px);
        }
        66% {
            transform: translateY(80px) translateX(12px);
        }
    }

    @keyframes float-3 {
        0%,
        100% {
            transform: translateY(0px) translateX(0px);
        }
        20% {
            transform: translateY(-25px) translateX(-12px);
        }
        40% {
            transform: translateY(-50px) translateX(18px);
        }
        60% {
            transform: translateY(-75px) translateX(-8px);
        }
        80% {
            transform: translateY(-100px) translateX(15px);
        }
    }

    @keyframes float-4 {
        0%,
        100% {
            transform: translateY(0px) translateX(0px);
        }
        50% {
            transform: translateY(50px) translateX(-18px);
        }
    }

    @keyframes float-5 {
        0%,
        100% {
            transform: translateY(0px) translateX(0px);
        }
        25% {
            transform: translateY(-40px) translateX(12px);
        }
        75% {
            transform: translateY(-80px) translateX(-15px);
        }
    }

    @keyframes float-6 {
        0%,
        100% {
            transform: translateY(0px) translateX(0px);
        }
        33% {
            transform: translateY(35px) translateX(20px);
        }
        66% {
            transform: translateY(70px) translateX(-12px);
        }
    }

    @keyframes float-7 {
        0%,
        100% {
            transform: translateY(0px) translateX(0px);
        }
        40% {
            transform: translateY(-45px) translateX(-18px);
        }
        80% {
            transform: translateY(-90px) translateX(10px);
        }
    }

    @keyframes float-8 {
        0%,
        100% {
            transform: translateY(0px) translateX(0px);
        }
        50% {
            transform: translateY(60px) translateX(22px);
        }
    }

    @keyframes float-9 {
        0%,
        100% {
            transform: translateY(0px) translateX(0px);
        }
        30% {
            transform: translateY(-30px) translateX(-20px);
        }
        70% {
            transform: translateY(-60px) translateX(14px);
        }
    }

    @keyframes float-10 {
        0%,
        100% {
            transform: translateY(0px) translateX(0px);
        }
        25% {
            transform: translateY(45px) translateX(-10px);
        }
        75% {
            transform: translateY(90px) translateX(16px);
        }
    }

    @keyframes float-11 {
        0%,
        100% {
            transform: translateY(0px) translateX(0px);
        }
        60% {
            transform: translateY(-70px) translateX(18px);
        }
    }

    /* Float + rotate animations for square particles */
    @keyframes float-rotate-1 {
        0%,
        100% {
            transform: translateY(0px) translateX(0px) rotate(0deg);
        }
        25% {
            transform: translateY(-50px) translateX(18px) rotate(90deg);
        }
        50% {
            transform: translateY(-100px) translateX(-12px) rotate(180deg);
        }
        75% {
            transform: translateY(-150px) translateX(22px) rotate(270deg);
        }
    }

    @keyframes float-rotate-2 {
        0%,
        100% {
            transform: translateY(0px) translateX(0px) rotate(0deg);
        }
        50% {
            transform: translateY(60px) translateX(-15px) rotate(180deg);
        }
    }

    @keyframes float-rotate-3 {
        0%,
        100% {
            transform: translateY(0px) translateX(0px) rotate(0deg);
        }
        33% {
            transform: translateY(40px) translateX(25px) rotate(120deg);
        }
        66% {
            transform: translateY(80px) translateX(-18px) rotate(240deg);
        }
    }

    @keyframes float-rotate-4 {
        0%,
        100% {
            transform: translateY(0px) translateX(0px) rotate(0deg);
        }
        40% {
            transform: translateY(-55px) translateX(-20px) rotate(144deg);
        }
        80% {
            transform: translateY(-110px) translateX(14px) rotate(288deg);
        }
    }
</style>
